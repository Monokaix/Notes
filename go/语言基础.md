# Go函数调用惯例

调用惯例是调用方和被调用方对于参数和返回值传递的约定，Go与C函数调用惯例的区别（对比汇编代码）

# C 语言

C语言的方式能够极大地减少函数调用的额外开销，但是也增加了实现的复杂度
CPU 访问栈的开销比访问寄存器高几十倍
需要单独处理函数参数过多的情况
六个以及六个以下的参数会按照顺序分别使用 edi、esi、edx、ecx、r8d 和 r9d 六个寄存器传递
六个以上的参数会使用栈传递，函数的参数会以从右到左的顺序依次存入栈中
参数返回值通过eax寄存器传递，由于只使用一个寄存器存储返回值，因此只能返回一个参数

# Go语言

而go的返回值在栈上分配，可以申请较多空间返回多个返回值
Go 语言的方式能够降低实现的复杂度并支持多返回值，但是牺牲了函数调用的性能
不需要考虑超过寄存器数量的参数应该如何传递
不需要考虑不同架构上的寄存器差异
函数入参和出参的内存空间需要在栈上进行分配

# 总结

main函数调用一个函数时，main函数会初始化自己的栈，申请参数地址和返回值栈空间，然后调用被调用的函数，被调函数会改变当前栈指针sp进行计算，并且main函数还会把main函数返回地址传给被调函数，被调函数执行完返回到这个地址，将执行权交给main函数，同时被调函数填充返回值空间的值，完成函数调用。

